# 统一显示逻辑说明

## 概述

本次修改统一了顶层模块中的显示控制逻辑，使寄存器、ALU和存储器显示都使用相同的控制方式，并且不受CPU时钟影响。

## 主要修改

### 1. 统一显示控制逻辑

所有显示控制现在都使用开关2、3、4进行控制：

- **开关2 (sw_i[2])**: 重置所有地址到0
- **开关3 (sw_i[3])**: 所有地址递增（上升沿触发）
- **开关4 (sw_i[4])**: 所有地址递减（上升沿触发）

### 2. 地址范围控制

每个显示类型都有其特定的地址范围：

- **寄存器地址**: 5位，范围 0-31 (REG_DATA_NUM = 31)
- **ALU地址**: 2位，范围 0-3 (ALU_DATA_NUM = 3)
- **存储器地址**: 4位，范围 0-15 (DMEM_DATA_NUM = 15)

### 3. 自动溢出处理

当地址达到最大值时，会自动归零：
- 寄存器地址：31 → 0
- ALU地址：3 → 0
- 存储器地址：15 → 0

当地址达到最小值时，会自动跳转到最大值：
- 寄存器地址：0 → 31
- ALU地址：0 → 3
- 存储器地址：0 → 15

## 显示模式

### 正常显示模式 (sw_i[0] = 0)

使用开关14-11选择显示内容：

| 开关[14:11] | 显示内容       | 说明                           |
| ----------- | -------------- | ------------------------------ |
| 4'b1000     | 指令           | 当前执行的指令                 |
| 4'b0100     | 寄存器数据     | 根据寄存器地址显示对应寄存器值 |
| 4'b0010     | ALU数据        | 根据ALU地址显示对应数据        |
| 4'b0001     | 数据存储器数据 | 根据存储器地址显示对应数据     |
| 4'b1001     | 程序计数器     | 当前PC值                       |
| 其他        | 默认值         | 0x76543210                     |

### 调试显示模式 (sw_i[10] = 1)

显示调试数据，不受其他开关影响。

### LED显示模式 (sw_i[0] = 1)

显示程序计数器值。

## ALU数据显示内容

ALU地址对应的显示内容：

| ALU地址 | 显示内容 | 说明            |
| ------- | -------- | --------------- |
| 2'b00   | PC_out   | 程序计数器      |
| 2'b01   | instr    | 当前指令        |
| 2'b10   | Addr_out | ALU结果（地址） |
| 2'b11   | Data_out | 数据输出        |

## 时钟控制

### CPU时钟控制

- **开关15 (sw_i[15])**: 控制CPU时钟分频
  - 0: 使用clkdiv[20]（较慢）
  - 1: 使用clkdiv[27]（较快）

- **开关1 (sw_i[1])**: CPU执行控制
  - 0: CPU正常运行
  - 1: CPU停止执行

### 显示时钟

显示逻辑使用独立的时钟（clkdiv[16]），不受CPU时钟影响，确保显示稳定。

## 清理的接口和信号

### 移除的接口

1. **sccomp模块**:
   - 移除了`DMType_out`输出端口（未使用）

### 移除的信号

1. **top_module模块**:
   - 移除了`led_disp_data`信号
   - 移除了`seg_data`中间信号
   - 简化了显示数据选择逻辑

## 使用示例

### 查看寄存器数据

1. 设置开关[14:11] = 4'b0100（寄存器显示模式）
2. 使用开关3递增寄存器地址
3. 使用开关4递减寄存器地址
4. 使用开关2重置到寄存器0

### 查看ALU数据

1. 设置开关[14:11] = 4'b0010（ALU显示模式）
2. 使用开关3/4切换ALU数据项
3. 观察PC、指令、地址、数据的变化

### 查看存储器数据

1. 设置开关[14:11] = 4'b0001（存储器显示模式）
2. 使用开关3/4切换存储器地址
3. 观察不同地址的数据

## 测试验证

提供了`unified_display_test.v`测试文件，验证：

1. 开关2重置功能
2. 开关3递增功能
3. 开关4递减功能
4. 各种显示模式切换
5. 地址溢出处理

## 优势

1. **统一控制**: 所有显示使用相同的控制方式
2. **独立时钟**: 显示不受CPU时钟影响，更稳定
3. **自动溢出**: 地址自动循环，用户友好
4. **代码简化**: 移除了冗余的接口和信号
5. **易于使用**: 统一的开关控制逻辑 